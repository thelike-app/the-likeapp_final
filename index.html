<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>LIKE</title>
  <style>
    body {
      background-color: black;
      color: white;
      font-family: Helvetica, sans-serif;
      text-align: center;
      margin: 0;
      padding: 0;
    }
    h1 {
      margin-top: 80px;
      font-size: 64px;
      letter-spacing: 2px;
    }
    input {
      padding: 10px;
      font-size: 16px;
      width: 280px;
      border: none;
      border-radius: 4px;
      margin-top: 20px;
      text-align: center;
    }
    button {
      margin-top: 15px;
      padding: 10px 20px;
      font-size: 16px;
      background-color: white;
      color: black;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    button:hover {
      background-color: #ccc;
    }
    button:disabled {
      background-color: #666;
      color: #999;
      cursor: not-allowed;
    }
    .tagline {
      margin-top: 10px;
      font-size: 14px;
      color: grey;
    }
    .footer {
      position: fixed;
      bottom: 20px;
      width: 100%;
      font-size: 12px;
      color: grey;
    }
    #results {
      margin-top: 30px;
      white-space: pre-wrap;
      text-align: left;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
      font-size: 14px;
      color: #ccc;
      background-color: #111;
      padding: 20px;
      border-radius: 8px;
      border: 1px solid #333;
      display: none;
    }
    .loading {
      margin-top: 20px;
      font-size: 14px;
      color: #999;
      display: none;
    }
    .error {
      color: #ff6b6b;
    }
    .player-name {
      color: #4ecdc4;
      font-size: 16px;
      font-weight: bold;
      margin-bottom: 10px;
    }
    .stat-line {
      margin: 5px 0;
      padding: 5px 0;
      border-bottom: 1px solid #333;
    }
    .stat-label {
      color: #999;
      display: inline-block;
      width: 120px;
    }
    .stat-value {
      color: white;
      font-weight: bold;
    }
  </style>
</head>
<body>

  <h1>LIKE</h1>
  <input type="text" id="playerInput" placeholder="Player name"/>
  <br/>
  <button onclick="analyzePlayer()" id="analyzeBtn">ANALYZE</button>
  <div class="tagline">Ask less. Get more.</div>

  <div class="loading" id="loading">Fetching player statistics...</div>
  <div id="results"></div>

  <div class="footer">
    We don't care who you are.
  </div>

  <script>
    let currentPage = 1;
    const pageSize = 10;

    async function analyzePlayer() {
      const playerName = document.getElementById("playerInput").value.trim();
      
      if (!playerName) {
        alert("Please enter a player name");
        return;
      }

      showLoading(true);
      hideResults();
      hideError();

      try {
        // Search for player in totals data
        const response = await fetch(`https://api.server.nbaapi.com/api/playertotals?page=${currentPage}&pageSize=${pageSize}&season=2024`);
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }

        const data = await response.json();
        
        // Find player by name (case insensitive)
        let player = data.data.find(p => 
          p.playerName.toLowerCase().includes(playerName.toLowerCase()) ||
          playerName.toLowerCase().includes(p.playerName.toLowerCase())
        );

        if (!player) {
          // Try to search in more pages
          let found = false;
          for (let page = 2; page <= 5 && !found; page++) {
            const nextResponse = await fetch(`https://api.server.nbaapi.com/api/playertotals?page=${page}&pageSize=${pageSize}&season=2024`);
            if (nextResponse.ok) {
              const nextData = await nextResponse.json();
              const foundPlayer = nextData.data.find(p => 
                p.playerName.toLowerCase().includes(playerName.toLowerCase()) ||
                playerName.toLowerCase().includes(p.playerName.toLowerCase())
              );
              if (foundPlayer) {
                player = foundPlayer;
                found = true;
              }
            }
          }
          
          if (!found) {
            throw new Error(`Player "${playerName}" not found. Please try a different name or check spelling.`);
          }
        }

        displayPlayerStats(player);

      } catch (error) {
        console.error('Error fetching player data:', error);
        showError(error.message || 'Failed to fetch player statistics. Please try again.');
      } finally {
        showLoading(false);
      }
    }

    function displayPlayerStats(player) {
      const resultsDiv = document.getElementById('results');
      
      const avgPoints = (player.points / player.games).toFixed(1);
      const avgRebounds = (player.totalRb / player.games).toFixed(1);
      const avgAssists = (player.assists / player.games).toFixed(1);
      const fgPercent = (player.fieldPercent * 100).toFixed(1);
      const threePercent = (player.threePercent * 100).toFixed(1);
      const ftPercent = (player.ftPercent * 100).toFixed(1);

      resultsDiv.innerHTML = `
        <div class="player-name">${player.playerName}</div>
        
        <div class="stat-line">
          <span class="stat-label">Team:</span>
          <span class="stat-value">${player.team}</span>
        </div>
        
        <div class="stat-line">
          <span class="stat-label">Position:</span>
          <span class="stat-value">${player.position}</span>
        </div>
        
        <div class="stat-line">
          <span class="stat-label">Age:</span>
          <span class="stat-value">${player.age}</span>
        </div>
        
        <div class="stat-line">
          <span class="stat-label">Games Played:</span>
          <span class="stat-value">${player.games}</span>
        </div>
        
        <div class="stat-line">
          <span class="stat-label">Points/Game:</span>
          <span class="stat-value">${avgPoints}</span>
        </div>
        
        <div class="stat-line">
          <span class="stat-label">Rebounds/Game:</span>
          <span class="stat-value">${avgRebounds}</span>
        </div>
        
        <div class="stat-line">
          <span class="stat-label">Assists/Game:</span>
          <span class="stat-value">${avgAssists}</span>
        </div>
        
        <div class="stat-line">
          <span class="stat-label">FG%:</span>
          <span class="stat-value">${fgPercent}%</span>
        </div>
        
        <div class="stat-line">
          <span class="stat-label">3P%:</span>
          <span class="stat-value">${threePercent}%</span>
        </div>
        
        <div class="stat-line">
          <span class="stat-label">FT%:</span>
          <span class="stat-value">${ftPercent}%</span>
        </div>
        
        <div class="stat-line">
          <span class="stat-label">Total Points:</span>
          <span class="stat-value">${player.points}</span>
        </div>
        
        <div class="stat-line">
          <span class="stat-label">Total Rebounds:</span>
          <span class="stat-value">${player.totalRb}</span>
        </div>
        
        <div class="stat-line">
          <span class="stat-label">Total Assists:</span>
          <span class="stat-value">${player.assists}</span>
        </div>
      `;

      showResults();
    }

    function showLoading(show) {
      document.getElementById('loading').style.display = show ? 'block' : 'none';
      document.getElementById('analyzeBtn').disabled = show;
    }

    function showError(message) {
      const resultsDiv = document.getElementById('results');
      resultsDiv.innerHTML = `<div class="error">${message}</div>`;
      showResults();
    }

    function hideError() {
      // Error is shown in results div, so hiding results will hide error
    }

    function showResults() {
      document.getElementById('results').style.display = 'block';
    }

    function hideResults() {
      document.getElementById('results').style.display = 'none';
    }

    // Allow Enter key to trigger search
    document.getElementById('playerInput').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        analyzePlayer();
      }
    });
  </script>

</body>
</html>
